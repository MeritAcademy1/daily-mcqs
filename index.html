<script>
const ADMIN_PASSWORD = "FalakPardiwala@786";

/* DEFAULT QUESTIONS */
const defaultQuestions = [
  {
    question: "A multinational corporation centralizes liquidity management but allows subsidiaries to execute FX transactions locally within defined limits. Which treasury structure best describes this arrangement?",
    options: [
      "Fully centralized treasury",
      "Fully decentralized treasury",
      "Hybrid treasury structure",
      "In-house bank model"
    ],
    correct: 2,
    explanation: "A hybrid treasury structure combines centralized policy and oversight with decentralized execution."
  },
  {
    question: "A company redesigns treasury operations so that gains from interest rate positioning and FX hedging directly impact divisional P&L. What is the MOST significant risk introduced by this change?",
    options: [
      "Reduced transparency in reporting",
      "Pressure to assume speculative positions",
      "Loss of economies of scale",
      "Weakened internal controls"
    ],
    correct: 1,
    explanation: "Profit-center treasury increases pressure to speculate."
  },
  {
    question: "Which responsibility MOST clearly differentiates the treasurer from the controller in a large organization?",
    options: [
      "Preparation of statutory financial statements",
      "Management of external auditor relationships",
      "Liquidity, funding, and financial risk management",
      "Oversight of internal accounting controls"
    ],
    correct: 2,
    explanation: "Liquidity and financial risk are treasury responsibilities."
  },
  {
    question: "A board establishes strict treasury policies but allows management discretion within defined limits. From a corporate governance perspective, this primarily addresses which issue?",
    options: [
      "Market risk exposure",
      "Operational efficiency",
      "Agency conflict",
      "Regulatory arbitrage"
    ],
    correct: 2,
    explanation: "This reduces agency conflict."
  },
  {
    question: "Why is the internal audit function typically structured to report directly to the board or audit committee?",
    options: [
      "To enhance operational efficiency",
      "To support treasury profit generation",
      "To ensure independence and objectivity",
      "To reduce compliance costs"
    ],
    correct: 2,
    explanation: "Direct reporting ensures independence."
  },
  {
    question: "Why are ethical standards particularly critical in treasury compared to other finance functions?",
    options: [
      "Treasury handles confidential market-sensitive information",
      "Treasury determines accounting standards",
      "Treasury controls operational staffing",
      "Treasury manages production assets"
    ],
    correct: 0,
    explanation: "Treasury has access to sensitive market information."
  },
  {
    question: "Which scenario BEST demonstrates treasury acting beyond its appropriate mandate?",
    options: [
      "Executing hedges within approved limits",
      "Optimizing short-term investments per policy",
      "Taking FX positions to boost earnings without exposure",
      "Centralizing bank account management"
    ],
    correct: 2,
    explanation: "Speculative FX positions violate treasury mandate."
  }
];

let questions = JSON.parse(localStorage.getItem("questions")) || defaultQuestions;

let index = 0, correct = 0, wrong = 0;
let timeLeft = 90, timer;
let student = "";

/* STUDENT FLOW */
function startTest() {
  student = document.getElementById("studentName").value.trim();
  if (!student) return alert("Please enter your name");

  document.getElementById("startPage").classList.add("hidden");
  document.getElementById("quizPage").classList.remove("hidden");
  loadQuestion();
}

function loadQuestion() {
  clearInterval(timer);
  timeLeft = 90;
  document.getElementById("timer").textContent = `Time Left: ${timeLeft}s`;
  document.getElementById("nextBtn").classList.add("hidden");
  document.getElementById("explanation").textContent = "";

  const q = questions[index];
  document.getElementById("question").textContent = `Q${index + 1}. ${q.question}`;

  const optionsDiv = document.getElementById("options");
  optionsDiv.innerHTML = "";

  q.options.forEach((opt, i) => {
    const div = document.createElement("div");
    div.className = "option";
    div.textContent = opt;
    div.onclick = () => selectAnswer(div, i);
    optionsDiv.appendChild(div);
  });

  timer = setInterval(() => {
    timeLeft--;
    document.getElementById("timer").textContent = `Time Left: ${timeLeft}s`;
    if (timeLeft === 0) {
      clearInterval(timer);
      wrong++;
      showCorrect();
    }
  }, 1000);
}

function selectAnswer(el, i) {
  clearInterval(timer);
  const q = questions[index];
  const opts = document.querySelectorAll(".option");
  opts.forEach(o => o.onclick = null);

  if (i === q.correct) {
    el.classList.add("correct");
    correct++;
  } else {
    el.classList.add("wrong");
    opts[q.correct].classList.add("correct");
    wrong++;
  }

  document.getElementById("explanation").textContent = q.explanation;
  document.getElementById("nextBtn").classList.remove("hidden");
}

function showCorrect() {
  const q = questions[index];
  document.querySelectorAll(".option")[q.correct].classList.add("correct");
  document.getElementById("explanation").textContent = q.explanation;
  document.getElementById("nextBtn").classList.remove("hidden");
}

function nextQuestion() {
  index++;
  if (index < questions.length) loadQuestion();
  else showResult();
}

function showResult() {
  document.getElementById("quizPage").classList.add("hidden");
  document.getElementById("resultPage").classList.remove("hidden");
  document.getElementById("finalName").textContent = `Name: ${student}`;
  document.getElementById("finalScore").textContent =
    `Correct: ${correct} | Incorrect: ${wrong}`;
  document.getElementById("finalAccuracy").textContent =
    `Accuracy: ${Math.round((correct / questions.length) * 100)}%`;
}

/* ADMIN FLOW */
function openAdmin() {
  const pass = prompt("Enter admin password");
  if (pass !== ADMIN_PASSWORD) return alert("Wrong password");

  document.getElementById("startPage").classList.add("hidden");
  document.getElementById("quizPage").classList.add("hidden");
  document.getElementById("resultPage").classList.add("hidden");
  document.getElementById("adminPage").classList.remove("hidden");

  document.getElementById("adminEditor").value =
    JSON.stringify(questions, null, 2);
}

function saveQuestions() {
  try {
    const edited = JSON.parse(document.getElementById("adminEditor").value);
    if (!Array.isArray(edited)) {
      alert("Invalid questions format");
      return;
    }
    localStorage.setItem("questions", JSON.stringify(edited));
    alert("Questions saved successfully");
    location.reload();
  } catch {
    alert("Invalid JSON format");
  }
}
</script>
